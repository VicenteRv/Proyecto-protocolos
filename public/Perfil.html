<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/LogoImg.png">
    <link rel="stylesheet" href="styles/general.css">
    <link rel="stylesheet" href="styles/perfil.css">
    <script>
        /*document.addEventListener('DOMContentLoaded', async function () {
            try {
                const response = await fetch('/api/auth/verificarJWT', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                if (!response.ok) {
                    window.location.href = '/Login.html';
                }
            } catch (error) {
                console.error('Error al verificar el JWT:', error);
                window.location.href = '/Login.html';
            }
        });*/
    </script>
    <title>ProSys - Perfil</title>
</head>

<body>
    <!--  BARRA DE NAVEGACIÓN  -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-logo">
                <img class="navbar-image" src="assets/LogoHorizontal.png" alt="">
            </a>
            <ul class="navbar-menu">
                <li class="navbar-item">
                    <a href="index.html" class="navbar-link">Inicio</a>
                </li>
                <li class="navbar-item">
                    <a href="Documentos.html" class="navbar-link">Documentos</a>
                </li>
                <li class="navbar-item">
                    <a href="Perfil.html" class="navbar-link">Perfil</a>
                </li>
                <li class="navbar-item">
                    <a href="Login.html" class="navbar-link">Inicio de sesión</a>
                </li>
                <li class="navbar-item">
                    <a href="RegistroProtocolo.html" class="navbar-link">Registro Protocolo</a>
                </li>
            </ul>
        </div>
    </nav>
    <!--    -->
    <!--  PÁGINA   -->
    <div class="perfil-container">
        <div class="perfil-sidebar">
            <img src="assets/FotoPerfil.jpg" alt="Foto de perfil" class="perfil-img" />
            <h2 id="usuario-nombre">Nombre del Estudiante</h2>
            <p id="usuario-boleta">Número de Boleta: 12345678</p>
            <p id="usuario-correo">Correo: estudiante@correo.com</p>
            <a href="EditarUsuario.html" class="btn-editar">Editar Perfil</a>
        </div>
        <div class="perfil-main-content">
            <div class="perfil-section">
                <h3>Biografía</h3>
                <p id="usuario-biografia">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus lacinia odio
                    vitae vestibulum
                    vestibulum. Cras venenatis euismod malesuada.</p>
            </div>
            <div class="perfil-grid-section">
                <h3>Tus Protocolos</h3>
                <div class="perfil-grid">
                    <!-- <a href="Protocolo.html" class="perfil-card">
                        <h4>Protocolo 1</h4>
                        <p>Fecha: 01/01/2024</p>
                        <p>Sinodal: Dr. Pérez</p>
                        <p>Sinodal: Mtro. García</p>
                        <p>Sinodal: Dr. Sánchez</p>
                        <p>Descripción breve del trabajo.</p>
                    </a>
                    <a href="Protocolo.html" class="perfil-card">
                        <h4>Protocolo 2</h4>
                        <p>Fecha: 15/03/2024</p>
                        <p>Sinodal: Mtro. García</p>
                        <p>Sinodal: Dr. Pérez</p>
                        <p>Sinodal: Dr. Sánchez</p>
                        <p>Descripción breve del trabajo.</p>
                    </a>
                    <a href="Protocolo.html" class="perfil-card">
                        <h4>Protocolo 3</h4>
                        <p>Fecha: 20/05/2024</p>
                        <p>Sinodal: Dra. López</p>
                        <p>Sinodal: Mtro. García</p>
                        <p>Sinodal: Dr. Pérez</p>
                        <p>Descripción breve del trabajo.</p>
                    </a>
                    <a href="Protocolo.html" class="perfil-card">
                        <h4>Protocolo 4</h4>
                        <p>Fecha: 10/07/2024</p>
                        <p>Sinodal: Ing. Martínez</p>
                        <p>Sinodal: Dr. Sánchez</p>
                        <p>Sinodal: Lic. Ruiz</p>
                        <p>Descripción breve del trabajo.</p>
                    </a>
                    <a href="Protocolo.html" class="perfil-card">
                        <h4>Protocolo 5</h4>
                        <p>Fecha: 25/09/2024</p>
                        <p>Sinodal: Lic. Ruiz</p>
                        <p>Sinodal: Mtro. García</p>
                        <p>Sinodal: Dr. Pérez</p>
                        <p>Descripción breve del trabajo.</p>
                    </a>
                    <a href="Protocolo.html" class="perfil-card">
                        <h4>Protocolo 6</h4>
                        <p>Fecha: 05/12/2024</p>
                        <p>Sinodal: Dr. Sánchez</p>
                        <p>Sinodal: Dr. Pérez</p>
                        <p>Sinodal: Ing. Martínez</p>
                        <p>Descripción breve del trabajo.</p>
                    </a> -->
                </div>
            </div>
        </div>
    </div>

    <!--  SCRIPT DE CONSULTA  -->
    <script>
        // Obtener Usuario
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                const response = await fetch('/api/usuarios/me', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: "include"
                });
                const data = await response.json();
                if (response.ok) {
                    console.log('Usuario:', data);
                    // // Actualizar datos de usuario en la interfaz de usuario
                    document.getElementById('usuario-nombre').innerText = data.nombre;
                    document.getElementById('usuario-boleta').innerText = `Boleta: ${data.boleta}`;
                    document.getElementById('usuario-correo').innerText = `Correo: ${data.correo}`;
                    //document.getElementById('usuario-biografia').innerText = data.biografia;
                }
                if (response.ok === false) {
                    console.log('Respuesta del servidor:', data.msg);
                }
            } catch (error) {
                console.error('Error en la petición:', error);
                alert('Hubo un error al intentar obtener el usuario.');
            }
        });

        // Obtener Protocolos
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                const protocolosContainer = document.querySelector('.perfil-grid');
                // Realizar la petición al backend para obtener el saldo
                const response = await fetch('/api/protocolos/me', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: "include"
                });
                const data = await response.json();
                if (response.ok) {
                    console.log('Respuesta del servidor:', data);

                    const protocolosContainer = document.querySelector('.perfil-grid');
                    const protocoloLink = document.createElement('a');
                    protocoloLink.href = "Protocolo.html";
                    protocoloLink.className = "perfil-card";
                    protocoloLink.innerHTML = `
                            <h4>${data.protocolo.nombre}</h4>
                            <hr>
                            <p>Director: Dr. Pérez</p>
                            <p>Director: Mtro. García</p>
                            <hr>
                            <p>Sinodal: Dr. Pérez</p>
                            <p>Sinodal: Mtro. García</p>
                            <p>Sinodal: Dr. Sánchez</p>
                            <hr>
                            <p>${data.protocolo.descripcion}</p>
                    `;
                    protocolosContainer.appendChild(protocoloLink);

                    // data.protocolo.forEach(protocolo => {
                    //     console.log(protocolo);
                    //     const protocoloDiv = document.createElement('div');
                    //     protocoloDiv.innerHTML = `
                    //     <a href="Protocolo.html" class="perfil-card">
                    //         <h4>${protocolo.nombre}</h4>
                    //         <p>Fecha: 01/01/2024</p>
                    //         <p>Sinodal: Dr. Pérez</p>
                    //         <p>Sinodal: Mtro. García</p>
                    //         <p>Sinodal: Dr. Sánchez</p>
                    //         <p>${protocolo.descripcion}</p>
                    //     </a>
                    // `;
                    //     protocolosContainer.appendChild(protocoloDiv);
                    // });

                } else {
                    console.log('Respuesta del servidor:', data);
                    const protocolosContainer = document.querySelector('.perfil-grid-section');
                    const protocoloDiv = document.createElement('div');
                    protocoloDiv.classList.add('noprotocolos');
                    protocoloDiv.innerHTML = `
                        <h4>Aún no tienes protocolos</h4>
                    `;
                    protocolosContainer.appendChild(protocoloDiv);
                    console.error('Error en la petición:', error);
                    alert('Hubo un error al intentar obtener los protocolos.');
                }

            } catch (error) {
                // const protocolosContainer = document.querySelector('.perfil-grid-section');
                // const protocoloDiv = document.createElement('div');
                // protocoloDiv.classList.add('noprotocolos');
                // protocoloDiv.innerHTML = `
                //     <h4>Error</h4>
                // `;
                // protocolosContainer.appendChild(protocoloDiv);
                console.error('Error en la petición:', error);
                // alert('Hubo un error al intentar obtener los protocolos.');
            }
        });
    </script>

    <!--  FOOTER  -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-logo">
                <img src="assets/LogoPrincipal.png" alt="Logo" class="footer-logo-img">
            </div>
            <div class="footer-aside">
                <p class="footer-text">
                    Todos los derechos reservados.
                </p>
                <ul class="footer-menu">
                    <li class="footer-item">
                        <a href="/politica" class="footer-link">Política de Privacidad</a>
                    </li>
                    <li class="footer-item">
                        <a href="/terminos" class="footer-link">Términos y Condiciones</a>
                    </li>
                    <li class="footer-item">
                        <a href="/contacto" class="footer-link">Contacto</a>
                    </li>
                </ul>
            </div>
        </div>
    </footer>
    <!--    -->

</body>

</html>