<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/LogoImg.png">
    <link rel="stylesheet" href="styles/general.css">
    <link rel="stylesheet" href="styles/login.css">
    <link rel="stylesheet" href="styles/registroUsuario.css">
    <title>ProSys - Registro de Usuario</title>
</head>

<body>
    <!--  PÁGINA   -->
    <div class="login-container">
        <div class="login-box">
            <h2>Registro</h2>
            <form class="login-form">
                <div class="form-group">
                    <label htmlFor="name">Nombre:</label>
                    <input type="text" id="name" placeholder="Ingrese su nombre" required />
                </div>
                <div class="form-group">
                    <label htmlFor="email">Correo:</label>
                    <input type="text" id="email" placeholder="Ingrese su correo" required />
                </div>
                <div class="form-group">
                    <label htmlFor="password">Contraseña:</label>
                    <input type="password" id="password" placeholder="Ingrese su contraseña" required />
                </div>
                <div class="form-group">
                    <label for="role">Tipo de usuario:</label>
                    <select id="rol" required>
                        <option value="">Seleccione una opción</option>
                        <option value="ALUMNO_ROL">Alumno</option>
                        <option value="PROFESOR_ROL">Profesor</option>
                    </select>
                </div>
                <div class="form-group hidden" id="group-boleta">
                    <label for="boleta">Número de boleta:</label>
                    <input type="text" id="boleta" placeholder="Ingrese su número de boleta" required />
                </div>
                <div class="form-group hidden" id="group-rol-profesor">
                    <label for="rol-profesor">Profesor Interno o Externo:</label>
                    <select id="rol-profesor" required>
                        <option value="">Seleccione una opción</option>
                        <option value="INTERNO">Interno</option>
                        <option value="EXTERNO">Externo</option>
                    </select>
                </div>
                <div class="form-group hidden" id="group-no-trabajador">
                    <label for="no-trabajador">Número de trabajador:</label>
                    <input type="text" id="no-trabajador" placeholder="Ingrese su número de trabajador" required />
                </div>
                <div class="form-group hidden" id="group-cedula">
                    <label for="cedula">Cédula Profesional:</label>
                    <input type="text" id="cedula" placeholder="Ingrese su cédula profesional" required />
                </div>
                <div class="button-group">
                    <button type="button" onclick="crearUsuario()" class="create-button-registro">Crear usuario</button>
                </div>
            </form>
            <a href="Login.html">¿Ya tienes una cuenta?</a>
        </div>
    </div>
    <script>
        // Mostrar inputs correspondientes a las secciones

        const rolSelect = document.getElementById('rol');
        const rolProfesorSelect = document.getElementById('rol-profesor');
        const groupBoleta = document.getElementById('group-boleta');
        const groupRolProfesor = document.getElementById('group-rol-profesor');
        const groupNoTrabajador = document.getElementById('group-no-trabajador');
        const groupCedula = document.getElementById('group-cedula');

        //Función para ocultar todos los grupos
        function hideAll() {
            groupBoleta.classList.add('hidden');
            groupRolProfesor.classList.add('hidden');
            groupNoTrabajador.classList.add('hidden');
            groupCedula.classList.add('hidden');
        }

        //Evento para el select de "Tipo de usuario"
        rolSelect.addEventListener('change', () => {
            hideAll();
            if (rolSelect.value === 'ALUMNO_ROL') {
                groupBoleta.classList.remove('hidden');
            } else if (rolSelect.value === 'PROFESOR_ROL') {
                groupRolProfesor.classList.remove('hidden');
            }
        });

        //Evento para el select de "Profesor Interno o Externo"
        rolProfesorSelect.addEventListener('change', () => {
            groupNoTrabajador.classList.add('hidden');
            groupCedula.classList.add('hidden');

            if (rolProfesorSelect.value === 'INTERNO') {
                groupNoTrabajador.classList.remove('hidden');
            } else if (rolProfesorSelect.value === 'EXTERNO') {
                groupCedula.classList.remove('hidden');
            }
        });

        // Crear Usuario
        async function crearUsuario() {
            let nombre = document.getElementById('name').value;
            let correo = document.getElementById('email').value;
            let password = document.getElementById('password').value;
            let rol = document.getElementById('rol').value;
            let boleta = document.getElementById('boleta').value;
            let tipoProfe = document.getElementById('rol-profesor').value;
            let numTrabajador = document.getElementById('no-trabajador').value;
            let cedula = document.getElementById('cedula').value;

            console.log(nombre, correo, password, rol, boleta, tipoProfe, numTrabajador, cedula);

            let externo;
            if (tipoProfe == "EXTERNO") {
                externo = true;
            }else{
                externo = false;
            }
  
            try {
                const response = await fetch('/api/usuarios', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nombre, correo, password, rol, boleta, externo }),
                    credentials: 'include'
                });
                const data = await response.json();
                if (response.ok) {
                    console.log('Usuario creado:', data);
                    alert("Se ha creado el Usuario con éxito. Por facor, inicia sesión.")
                    window.location.href = 'Login.html';
                } else {
                    console.log('Respuesta del servidor:', data.errors.map(error => error.msg).join('\n'));
                }
            } catch (error) {
                console.log('Error:', error);
                alert(error)
            }
        }
    </script>

</body>

</html>